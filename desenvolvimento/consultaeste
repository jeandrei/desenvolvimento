set @protocolo = 242019;
SELECT                          
    (SELECT 
        count(fila.id) 
    FROM 
        etapa,fila 
    WHERE 
         etapa.idade_minima<=(DATEDIFF(NOW(), (SELECT nascimento FROM fila WHERE protocolo = @protocolo))) 
    AND 
         etapa.idade_maxima>=(DATEDIFF(NOW(), (SELECT nascimento FROM fila WHERE protocolo = @protocolo)))
 
    AND
        fila.registro <= (SELECT fila.registro FROM fila WHERE fila.protocolo = @protocolo)
    ) as count,
    fila.registro as registro,
    fila.responsavel as responsavel, 
    fila.nomecrianca as nome, 
    fila.nascimento as nascimento,
    fila.protocolo as protocolo,
    fila.status as status,
    (SELECT descricao FROM etapa WHERE DATEDIFF(NOW(), fila.nascimento)>=idade_minima AND DATEDIFF(NOW(), fila.nascimento)<=idade_maxima) as etapa
    
FROM
fila 
WHERE fila.protocolo=@protocolo





set @protocolo = 232019;
SELECT 
        
    FROM 
        fila,etapa
    WHERE 
        



        ((DATEDIFF(NOW(), '2015-11-30')) >= 1089) AND ((DATEDIFF(NOW(), '2015-11-30')) <= 1454)
                        1235                                        1235





SELECT DATEDIFF(NOW(), '2015-11-30')




SELECT id,descricao FROM etapa WHERE etapa.idade_minima<=(DATEDIFF(NOW(), '2015-11-30')) AND etapa.idade_maxima>=(DATEDIFF(NOW(), '2015-11-30'))



//retorna id e descrição da etapa a partir do protocolo
set @protocolo = 232019;
SELECT 
    id,descricao 
FROM 
    etapa 
WHERE 
    etapa.idade_minima<=(DATEDIFF(NOW(), (SELECT nascimento FROM fila WHERE protocolo = @protocolo))) 
AND 
    etapa.idade_maxima>=(DATEDIFF(NOW(), (SELECT nascimento FROM fila WHERE protocolo = @protocolo)))




//retorna id  a partir do protocolo
set @protocolo = 242019;
SELECT 
    id 
FROM 
    etapa 
WHERE 
    etapa.idade_minima<=(DATEDIFF(NOW(), (SELECT nascimento FROM fila WHERE protocolo = @protocolo))) 
AND 
    etapa.idade_maxima>=(DATEDIFF(NOW(), (SELECT nascimento FROM fila WHERE protocolo = @protocolo)))



set @protocolo = 242019;
    SELECT 
        count(fila.id) 
    FROM 
        etapa,fila 
    WHERE 
        (DATEDIFF(NOW(), (SELECT nascimento FROM fila WHERE protocolo = @protocolo)))>=etapa.idade_minima
    AND
         (DATEDIFF(NOW(), (SELECT nascimento FROM fila WHERE protocolo = @protocolo)))<=etapa.idade_maxima


















